@{
    ViewData["Title"] = "Claims System - Lecturer: View Claims";
}
@model List<MonthlyClaimsSystem.Models.Claim>

<style>
    .claim-card {
        background-color: white;
        border-left: 6px solid #c82333;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 0 10px rgba(0,0,0,0.3);
        color: #f1f1f1;
    }

    .claim-approved { border-left: 6px solid #28a745; }
    .claim-pending { border-left: 6px solid #ffc107; }
    .claim-denied { border-left: 6px solid #dc3545; }

    .claim-card h4 { color: black; margin-bottom: 10px; }
    .claim-card .claim-meta { color: dimgray; font-size: 14px; margin-bottom: 10px; }

    .claim-card .status {
        font-weight: bold;
        padding: 6px 12px;
        border-radius: 8px;
        display: inline-block;
    }

    .status-approved { background-color: #28a745; color: white; }
    .status-pending { background-color: #ffc107; color: black; }
    .status-denied { background-color: #dc3545; color: white; }

    .system-log { font-style: italic; color: gray; }
    .human-log { color: black; }

    .cancel-btn {
        background-color: #6c757d;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        text-decoration: none;
        display: inline-block;
        font-weight: bold;
        transition: background-color 0.3s ease;
    }
    .cancel-btn:hover { background-color: #5a6268; color: white; }

    body { background-color: #121212; font-family: 'Segoe UI', sans-serif; }
</style>

@foreach (var claim in Model)
{
    var statusClass = claim.Status.ToLower() switch
    {
        "approved" => "status-approved",
        "pending" => "status-pending",
        "denied" => "status-denied",
        _ => "status-pending"
    };

    var cardClass = claim.Status.ToLower() switch
    {
        "approved" => "claim-approved",
        "pending" => "claim-pending",
        "denied" => "claim-denied",
        _ => "claim-pending"
    };

    <div class="claim-card @cardClass">
        <h4>Claim #@claim.ClaimId — @claim.ClaimType</h4>

        <div class="claim-meta">
            <strong>Month:</strong> @claim.ClaimMonth<br />
            <strong>Hours:</strong> @claim.HoursWorked hrs at R @claim.HourlyRate/hr<br />
            <strong>Total:</strong> R @(claim.HoursWorked * claim.HourlyRate)<br />
            <strong>Submitted:</strong> @claim.SubmittedAt.ToString("f")<br />

            @if (!string.IsNullOrEmpty(claim.AttachmentPath))
            {
                <strong>Attachment:</strong>
                <a href="@claim.AttachmentPath" target="_blank">@claim.AttachmentName</a><br />
            }

            <strong>Notes:</strong> @claim.Notes


            @{
                var latestLog = claim.StatusLogs.OrderByDescending(l => l.ChangeDate).FirstOrDefault();
                if (latestLog != null && !string.IsNullOrWhiteSpace(latestLog.Reason))
                {
                    <p class="text-muted"><strong>System/Reason:</strong> @latestLog.Reason</p>
                }
            }

            <ul class="list-group mt-2">
                @foreach (var log in claim.StatusLogs.OrderByDescending(l => l.ChangeDate))
                {
                    var cssClass = log.IsSystemChange ? "system-log" : "human-log";
                    var actor = log.ChangedBy;

                    <li class="list-group-item @cssClass">
                        <strong>@log.NewStatus</strong> by @actor on @log.ChangeDate.ToString("f")

                        @if (!string.IsNullOrWhiteSpace(log.Reason))
                        {
                            <br />
                            <strong>Reason:</strong> @log.Reason
                        }
                    </li>
                }
            </ul>
        </div>

        <div class="status @statusClass">@claim.Status</div>
    </div>
}
<a class="btn cancel-btn mt-4" asp-controller="Lecturer" asp-action="Lecturer_Dashboard">Return</a>
